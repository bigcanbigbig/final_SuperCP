<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
<script type="text/javascript" src="http://cdnjs.cloudflare.com/ajax/libs/jquery/2.2.2/jquery.min.js"></script>
<script type="text/javascript" src="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>
<script type="text/javascript" src="http://fezvrasta.github.io/bootstrap-material-design/dist/js/material.min.js"></script>
<script type="text/javascript" src="http://fezvrasta.github.io/bootstrap-material-design/dist/js/ripples.min.js"></script>
<script type="text/javascript" src="http://cdnjs.cloudflare.com/ajax/libs/angular.js/1.5.2/angular.min.js"></script>
<script type="text/javascript" src="http://cdnjs.cloudflare.com/ajax/libs/angular-filter/0.5.8/angular-filter.js"></script>
<script type="text/javascript" src="https://cdn.firebase.com/js/client/2.2.4/firebase.js"></script>
<script type="text/javascript" src="http://cdn.firebase.com/libs/angularfire/1.2.0/angularfire.min.js"></script>

<link href="assets/css/literallycanvas.css" rel="stylesheet">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, user-scalable=no" />
<style type="text/css">
      .fs-container {
        width: 1000px;
        margin: auto;
      }

      .literally {
        width: 100%;
        height: 75%;
        position: relative;
      }

    </style>
<%
if(uName == ""){
  %><a href="/register">註冊</a> 
<a href="/login">登入</a><a href="/">回首頁</a><br/><%
}else{
  %><h3>哈囉! <%=uName%></h3>
  <a href="/personal">我的作品</a>
  <a href="/">回首頁</a>
  <%
}

%>

<h3>上船底圖</h3>
<input type="file" id="canvas-bg-image" accept="image/*"/>
<input type="button" id="up-bg-img" onclick="upBgImg();" value="上傳" />

<h3>上船小圖</h3>
<input type="file" id="canvas-up-image" accept="image/*"/>
<input type="button" id="up-img" onclick="upImg();" value="上傳" />

<script>
/*-----------------上船底圖---------------------*/



$("#canvas-bg-image").on("change", function(event) {

  var file = event.target.files[0];
  var reader = new FileReader();
  reader.readAsDataURL(file);
  reader.onload = function(arg) {

  var backgroundImage = new Image();
  backgroundImage.src = arg.target.result;
  console.log('sssss');
  console.log(backgroundImage.src);
  console.log(backgroundImage.width);

  lc = LC.init(
      document.getElementById("lc"),
      {
        imageURLPrefix: 'assets/plugins/lc-images',
        toolbarPosition: 'bottom',
        defaultStrokeWidth: 2,
        strokeWidths: [1, 2, 3, 5, 30],
        backgroundShapes: [
          LC.createShape(
            'Image', {x: 0, y: 0, image: backgroundImage, scale: 2})
        ]
      });

     
    
  };

});



</script>




<script>
/*-----------------上船小圖---------------------*/
$("#canvas-up-image").on("change", function(event) {

  var file = event.target.files[0];
  var reader = new FileReader();
  reader.readAsDataURL(file);
  reader.onload = function(arg) {

  var upImage = new Image();
  upImage.src = arg.target.result;
  console.log('sssss');
  console.log(upImage.src);
  console.log(upImage.width);
  lc.saveShape(LC.createShape('Image', {x: 100, y: 100, image: upImage}));

  };

});



</script>

<div class="fs-container">
      <div id="lc"></div>
    </div>


    <!-- you really ought to include react-dom, but for react 0.14 you don't strictly have to. -->
    <script src="assets/js/react-0.14.3.js"></script>
    <script src="assets/js/literallycanvas.js"></script>

    <script type="text/javascript">
      var lc = LC.init(document.getElementById("lc"), {
        imageURLPrefix: 'assets/plugins/lc-images',
        toolbarPosition: 'bottom',
        defaultStrokeWidth: 2,
        strokeWidths: [1, 2, 3, 5, 30]
      });

    </script>


<form class="controls export">
  <input type="submit" data-action="export-as-png" value="Export as PNG">
</form>

<script type="text/javascript">

//---------------------------------輸出圖片--------------------
//寫死user---->testABC
var uName = "<%=uName%>";
var uAccount = "<%=uAccount%>";



    console.log('gggg');
    $('.controls.export [data-action=export-as-png]').click(function(e) {

    if(uAccount == ""){
      alert("請先登入!");
      window.location = "/login";
    }else{
    e.preventDefault();
      //window.open(lc.getImage().toDataURL());
      console.log("NAURLLLLL:"+lc.getImage());
      console.log("URLLLLL:"+lc.getImage().toDataURL());


     var img = new Firebase("https://supercp-a8e9e.firebaseio.com/images/"+uAccount);
     var index_img = new Firebase("https://supercp-a8e9e.firebaseio.com/images/total");

   img.push({
      date: Firebase.ServerValue.TIMESTAMP,
      base64: lc.getImage().toDataURL(),
      uName: "<%=uName%>",
      uId: 1
   });
   index_img.push({
      date: Firebase.ServerValue.TIMESTAMP,
      base64: lc.getImage().toDataURL(),
      uName: "<%=uName%>",
      uId: 1
   });
    }
      

});

</script>